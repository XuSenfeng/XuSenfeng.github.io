---
layout: post
title: "控制脚本《Linux命令行与Shell脚本编程大全》" 
date:   2022-8-7 15:39:08 +0800
tags: 《Linux命令行与Shell脚本编程大全》 Linux   
---

# 控制脚本

## 处理信号

Linux利用信号在系统进程之间进行通讯, 用这些信号来停止、启动、终止进程。可以通过对脚本进行编程, 使其在收到特定信号时执行某些命令，从而控制shell脚本的操作

默认情况下，bash shell会忽略收到的任何SIGQUIT (3)和SIGTERM (5)信号（正因为这样，交互式shell才不会被意外终止）。但是bash shell会处理收到的SIGHUP (1)和SIGINT (2)信号

如果bash  shell收到了SIGHUP信号，比如当你要离开一个交互式shell，它就会退出。但在退出之前，它会将SIGHUP信号传给所有由该shell所启动的进程

通过SIGINT信号，可以中断shell。Linux内核会停止为shell分配CPU处理时间。这种情况发生时，shell会将SIGINT信号传给所有由它所启动的进程，以此告知出现的状况

shell会将这些信号传给shell脚本程序来处理。而shell脚本的默认行为是忽略这些信号。它们可能会不利于脚本的运行。要避免这种情况，你可以脚本中加入识别信号的代码，并执行命令来处理信号

### 生成信号

#### 中断进程

Ctrl+C发送SIGINT信号, 停止shell当前的进程

#### 暂停进程

在进程运行期间暂停

尽管有时这可能会比较危险（比如，脚本打开了一个关键的系统文件的文件锁），但通常它可以在不终止进程的情况下使你能够深入脚本内部一窥究竟

Ctrl+Z组合键会生成一个SIGTSTP信号，停止shell中运行的任何进程

停止进程会让程序继续保留在内存中，并能从上次停止的位置继续运行

既然你已经知道了已停止作业的PID，就可以用kill命令来发送一个SIGKILL信号来终止它

但下次如果你做了能够产生shell提示符的操作（比如按回车键），你就会看到一条消息，显示作业已经被终止了。每当shell产生一个提示符时，它就会显示shell中状态发生改变的作业的状态。在你终止一个作业后，下次强制shell生成一个提示符时，shell会显示一条消息，说明作业在运行时被终止了